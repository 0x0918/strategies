
> 策略名称

基于箱体理论的交易策略

> 策略作者

程文

> 策略描述

#### 箱体理论的由来

第一次接触箱体理论是在《我如何从股市赚了200万》这本书中看到的，作者尼古拉斯·达瓦斯作为一个舞蹈家，在每次全球巡演之后，就用挣来的钱投资于股票，并且在短短几年内就赚到了200万美元，他所用的方法就是箱体理论。

这在当时是一件很不可思议的一件事情，以至于《时代》杂志也对他进行了报道。后来他将自己的交易历程、交易方法写成几本书。在《我在股市活了下来》同样也提到了箱体理论（Box theory）。

#### 什么是箱体理论

所谓的箱体，也可以称为一种形态，它的理论根基借鉴了支撑线和阻力线。通常情况下，当价格上涨到前期高点时，会遇到卖压使价格回落，当价格下跌到前期低点时，会遇到买压使价格上升。如果价格多次这样来来回回上下运动，就可以根据一段时间的历史价格的高点与低点，形成一个箱体（Box theory）。
 ![IMG](https://www.fmz.cn/upload/asset/39850cdb149eb687a2cb.jpg) 
箱体的概念是人为的主观定义，理论上箱体有上下阻力和支撑的作用，价格会始终在箱体里面上下运动。一旦价格向上突破箱体上轨，就意味着这是一股比阻力线更强劲的多头力量，未来价格可能会形成多头趋势，并上涨到预期的另一个箱子。反之，一旦价格向下突破箱体下轨，就意味着这是一股比支撑线更强劲的空头力量，未来价格可能会形成空头趋势，并下跌到预期的另一个箱子。

#### 箱体理论的精髓

箱体理论的思想是通过价格箱体来度量未来可能的价格，当价格向上突破箱体顶部之后，预示着价格将会到达更高的箱体。反之当价格向下跌破箱体底部之后，预示着价格讲会到达更低的箱体。
 ![IMG](https://www.fmz.cn/upload/asset/3a5bd56544d4758e37d8.jpg) 
所以，当价格有效向上突破箱体顶部，那么之前的阻力线就会变成支撑线，价格就会在未来的一段时间内进入上升周期，或者进入更高的箱体。同理当价格有效向下突破箱体底部，那么之前的支撑线就会变成阻力线，价格就会在未来的一段时间内进入下降周期，或者进入更低的箱体。

当然，实际上箱体形态在市场中并不是四四方方像一个箱子一样，我们知道价格走势并不总是规规矩矩，就如上图一样，有时候箱体会呈现出标准的W型或者M型，但有时候它也会出现前高后低或者前低后高的形态，甚至会出现奔走的旗型形态。

#### 体理论的公式和策略逻辑

- 支撑价 = N周期最低的收盘价
- 阻力价 = N周期最高的收盘价
- 箱体高度 = 阻力家 - 支撑价

#### 箱体理论My语言

```
N=50;
PRICE:=(OPEN+HIGH+LOW+CLOSE*2)/5;
UPPERBAND:REF(HHV(PRICE,N),1);
LOWERBAND:REF(LLV(PRICE,N),1);
C>=UPPERBAND,BPK;
C<=LOWERBAND,SPK;
WWW.FMZ.COM:C,NODRAW;
MID=(UPPERBAND+LOWERBAND)/2;
C<MID||C<LLV(PRICE,N/2),SP;
C>MID||C>HHV(PRICE,N/2),BP;
AUTOFILTER;
```

以上就是基于箱体理论的交易策略，支持商品期货和数字货币。在计算箱体顶部和底部的时候，并没有有最高价和最低价，而是用开盘价+最高价+最低价+2倍的收盘价的平均值，这样做的好处是，可以过滤一部分极端行情时产生的极端价格。

#### 策略回测

为了更接近真实的交易环境，我们在回测时采用开平仓各2跳以及2倍的手续费来压力测试，测试环境如下：

- 行情品种：铁矿石指数
- 交易品种：铁矿石主力
- 时间：2013年10月23日~2019年07月18日
- 周期：小时线
- 滑点：开平仓各2跳
- 手续费：交易所2倍

**资金曲线**
 ![IMG](https://www.fmz.cn/upload/asset/3a1be9c941999d309884.png) 
整体来看回测的资金曲线是稳步向上的，无论是在上涨行情中或者在下跌行情中，策略在市场走势流畅的时候表现不错，基本上每一个较大的趋势行情都能获利。并且在行情处于震荡时期，也能较好的控制资金曲线的回撤。

#### 总结

作为一种古老的交易方法，箱体理论在当今国内商品期货和数字货币中，依然保持着活力。虽然本篇的策略比较简单，但大道至简在交易者领域也一样适用。一个正确的策略框架是不在乎每次交易的得与失，而是站在一个全局的角度看，只要这个策略符合亏小赢大，那么长期坚持下来就能取得稳定的盈利。


> 策略参数



|参数|默认值|描述|
|----|----|----|
|N|25|N|


> 源码 (麦语言)

``` pascal
(*backtest
start: 2015-02-22 00:00:00
end: 2019-07-20 00:00:00
period: 1h
exchanges: [{"eid":"Futures_CTP","currency":"FUTURES"}]
args: [["SlideTick",0,126961],["ContractType","i888",126961]]
*)

PRICE:=(OPEN+HIGH+LOW+CLOSE*2)/5;
UPPERBAND^^REF(HHV(PRICE,N),1);
LOWERBAND^^REF(LLV(PRICE,N),1);
C>=UPPERBAND,BPK;
C<=LOWERBAND,SPK;
MID^^(UPPERBAND+LOWERBAND)/2;
C<MID||C<LLV(PRICE,N/2),SP;
C>MID||C>HHV(PRICE,N/2),BP;
AUTOFILTER;
```

> 策略出处

https://www.fmz.cn/strategy/326010

> 更新时间

2021-11-11 09:45:18
